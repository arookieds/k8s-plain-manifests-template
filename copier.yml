# Copier template for Kubernetes deployments without Helm charts
_min_copier_version: "9.0.0"
_subdirectory: template
_templates_suffix: .jinja
_envops:
  block_start_string: "{%"
  block_end_string: "%}"
  variable_start_string: "{{"
  variable_end_string: "}}"
  keep_trailing_newline: true
  trim_blocks: true
  lstrip_blocks: true

# Questions
project_name:
  type: str
  help: "Project/Application name (lowercase, no spaces)"
  validator: "{% if not project_name %}Required{% endif %}"

project_description:
  type: str
  help: "Brief description"
  default: ""

namespace:
  type: str
  help: "Kubernetes namespace"
  default: "{{ project_name }}"

app_type:
  type: str
  help: "Application type"
  choices:
    - "stateless"  # Deployment
    - "stateful"   # StatefulSet
    - "daemon"     # DaemonSet
    - "job"        # Job/CronJob
  default: "stateless"

container_image:
  type: str
  help: "Container image (e.g., nginx:1.21)"
  validator: "{% if not container_image %}Required{% endif %}"

container_port:
  type: int
  help: "Container port"
  default: 8080

service_type:
  type: str
  help: "Service type"
  choices:
    - "ClusterIP"
    - "NodePort"
    - "LoadBalancer"
    - "None"
  default: "ClusterIP"

service_port:
  type: int
  help: "Service port"
  default: 80
  when: "{{ service_type != 'None' }}"

storage_class:
  type: str
  help: "StorageClass for PVCs"
  default: "longhorn"
  when: "{{ app_type == 'stateful' }}"

pvc_size:
  type: str
  help: "PVC size (e.g., 10Gi)"
  default: "10Gi"
  when: "{{ app_type == 'stateful' }}"

use_configmap:
  type: bool
  help: "Create ConfigMap?"
  default: false

use_sealed_secrets:
  type: bool
  help: "Create Sealed Secret?"
  default: false

create_environments:
  type: bool
  help: "Create environment overlays?"
  default: true

enable_ingress:
  type: bool
  help: "Configure Ingress?"
  default: false

ingress_host:
  type: str
  help: "Ingress hostname"
  when: "{{ enable_ingress }}"

ingress_class:
  type: str
  help: "IngressClass name"
  default: "traefik"
  when: "{{ enable_ingress }}"

resource_limits_cpu:
  type: str
  help: "CPU limit"
  default: "1000m"

resource_limits_memory:
  type: str
  help: "Memory limit"
  default: "1Gi"

resource_requests_cpu:
  type: str
  help: "CPU request"
  default: "500m"

resource_requests_memory:
  type: str
  help: "Memory request"
  default: "512Mi"

replica_count:
  type: int
  help: "Replicas"
  default: 1
  when: "{{ app_type in ['stateless', 'stateful'] }}"

_tasks:
  - command: "git init"
    when: "{% if not _copier_conf.src_path.startswith('http') %}true{% else %}false{% endif %}"
  - command: "git add ."
    when: "{% if not _copier_conf.src_path.startswith('http') %}true{% else %}false{% endif %}"
  - command: "git commit -m 'Initial commit'"
    when: "{% if not _copier_conf.src_path.startswith('http') %}true{% else %}false{% endif %}"
